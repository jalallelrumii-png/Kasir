
<!DOCTYPE html>
<html lang="id">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartKasir Pro</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" contentcontent="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 overflow-hidden">
    <div id="root"></div>

    <!-- Script Utama (Babel transpile on the fly) -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';

        // --- CONSTANTS & ICONS ---
        const CATEGORIES = ['Semua', 'Makanan', 'Minuman', 'Snack', 'Lainnya'];
        const Icons = {
            Home: () => <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            Inventory: () => <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>,
            History: () => <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 8v4l3 3"/><circle cx="12" cy="12" r="10"/></svg>,
            Cart: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            ChevronLeft: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"/></svg>,
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
        };

        const INITIAL_PRODUCTS = [
            { id: '1', name: 'Nasi Goreng Special', price: 25000, category: 'Makanan', stock: 50, image: 'https://picsum.photos/seed/nasi/400/300' },
            { id: '2', name: 'Es Teh Manis', price: 5000, category: 'Minuman', stock: 100, image: 'https://picsum.photos/seed/teh/400/300' },
            { id: '3', name: 'Kopi Susu Aren', price: 18000, category: 'Minuman', stock: 40, image: 'https://picsum.photos/seed/coffee/400/300' },
            { id: '4', name: 'Kerupuk Udang', price: 3000, category: 'Snack', stock: 200, image: 'https://picsum.photos/seed/snack/400/300' },
        ];

        // --- COMPONENTS ---

        const InventoryView = ({ products, setProducts }) => {
            const [editing, setEditing] = useState(null);
            
            const save = (e) => {
                e.preventDefault();
                if (editing.id) {
                    setProducts(prev => prev.map(p => p.id === editing.id ? editing : p));
                } else {
                    setProducts(prev => [...prev, { ...editing, id: Date.now().toString(), image: 'https://picsum.photos/400/300' }]);
                }
                setEditing(null);
            };

            return (
                <div className="p-4 space-y-6 max-w-4xl mx-auto pb-24">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-black text-slate-800">Stok Barang</h2>
                        <button onClick={() => setEditing({ name: '', price: 0, stock: 0, category: 'Makanan' })} className="bg-indigo-600 text-white p-3 px-6 rounded-2xl font-bold flex items-center gap-2 shadow-lg shadow-indigo-100">Baru</button>
                    </div>
                    <div className="bg-white rounded-3xl border shadow-sm overflow-hidden overflow-x-auto">
                        <table className="w-full text-left text-sm min-w-[500px]">
                            <thead className="bg-slate-50 text-slate-400 font-bold uppercase text-[10px]">
                                <tr><th className="p-4">Produk</th><th className="p-4">Stok</th><th className="p-4">Harga</th><th className="p-4 text-right">Aksi</th></tr>
                            </thead>
                            <tbody className="divide-y">
                                {products.map(p => (
                                    <tr key={p.id}>
                                        <td className="p-4 font-bold">{p.name}</td>
                                        <td className={`p-4 font-black ${p.stock < 10 ? 'text-rose-500' : 'text-emerald-500'}`}>{p.stock}</td>
                                        <td className="p-4">Rp {p.price.toLocaleString('id-ID')}</td>
                                        <td className="p-4 text-right">
                                            <button onClick={() => setEditing(p)} className="text-indigo-600 font-bold">Edit</button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    {editing && (
                        <div className="fixed inset-0 z-[110] flex items-center justify-center p-4">
                            <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={() => setEditing(null)} />
                            <form onSubmit={save} className="relative bg-white w-full max-w-md rounded-[2.5rem] p-8 space-y-4 shadow-2xl">
                                <h3 className="text-xl font-black">{editing.id ? 'Edit Produk' : 'Tambah Baru'}</h3>
                                <input required placeholder="Nama Produk" className="w-full bg-slate-100 rounded-2xl p-4 font-bold outline-none" value={editing.name} onChange={e => setEditing({...editing, name: e.target.value})} />
                                <div className="grid grid-cols-2 gap-4">
                                    <input required type="number" placeholder="Harga" className="w-full bg-slate-100 rounded-2xl p-4 font-bold outline-none" value={editing.price || ''} onChange={e => setEditing({...editing, price: Number(e.target.value)})} />
                                    <input required type="number" placeholder="Stok" className="w-full bg-slate-100 rounded-2xl p-4 font-bold outline-none" value={editing.stock || ''} onChange={e => setEditing({...editing, stock: Number(e.target.value)})} />
                                </div>
                                <div className="flex gap-2 pt-4">
                                    <button type="button" onClick={() => setEditing(null)} className="flex-1 py-4 font-bold text-slate-400">Batal</button>
                                    <button type="submit" className="flex-[2] py-4 bg-indigo-600 text-white rounded-2xl font-black">SIMPAN</button>
                                </div>
                            </form>
                        </div>
                    )}
                </div>
            );
        };

        const HistoryView = ({ transactions }) => (
            <div className="p-4 space-y-6 max-w-4xl mx-auto pb-24">
                <div className="bg-indigo-600 rounded-[2.5rem] p-8 text-white shadow-xl">
                    <p className="text-indigo-200 text-xs font-bold uppercase">Total Omzet</p>
                    <h2 className="text-4xl font-black">Rp {transactions.reduce((s, t) => s + t.total, 0).toLocaleString('id-ID')}</h2>
                </div>
                <div className="space-y-4">
                    {transactions.map(t => (
                        <div key={t.id} className="bg-white rounded-[2rem] p-6 border shadow-sm">
                            <div className="flex justify-between items-start">
                                <div>
                                    <p className="text-xs font-bold text-slate-400">{new Date(t.timestamp).toLocaleTimeString('id-ID')}</p>
                                    <span className="text-xs font-black text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-full mt-1 inline-block">{t.paymentMethod}</span>
                                </div>
                                <p className="text-lg font-black">Rp {t.total.toLocaleString('id-ID')}</p>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        );

        const App = () => {
            const [activeView, setActiveView] = useState('POS');
            const [products, setProducts] = useState(() => JSON.parse(localStorage.getItem('sk_products')) || INITIAL_PRODUCTS);
            const [transactions, setTransactions] = useState(() => JSON.parse(localStorage.getItem('sk_transactions')) || []);
            const [cart, setCart] = useState([]);
            const [isCartOpen, setIsCartOpen] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [activeCategory, setActiveCategory] = useState('Semua');

            useEffect(() => {
                localStorage.setItem('sk_products', JSON.stringify(products));
                localStorage.setItem('sk_transactions', JSON.stringify(transactions));
            }, [products, transactions]);

            const addToCart = (p) => {
                setCart(prev => {
                    const ex = prev.find(i => i.id === p.id);
                    if (ex) return prev.map(i => i.id === p.id ? {...i, quantity: i.quantity + 1} : i);
                    return [...prev, {...p, quantity: 1}];
                });
                setIsCartOpen(true);
            };

            const filteredProducts = products.filter(p => 
                p.name.toLowerCase().includes(searchTerm.toLowerCase()) && 
                (activeCategory === 'Semua' || p.category === activeCategory)
            );

            const total = cart.reduce((s, i) => s + (i.price * i.quantity), 0);

            const handlePay = () => {
                const newTrx = { id: Date.now(), total, timestamp: Date.now(), paymentMethod: 'CASH' };
                setTransactions([newTrx, ...transactions]);
                setProducts(products.map(p => {
                    const item = cart.find(c => c.id === p.id);
                    return item ? {...p, stock: p.stock - item.quantity} : p;
                }));
                setCart([]);
                setIsCartOpen(false);
                alert("Pembayaran Berhasil!");
            };

            return (
                <div className="flex flex-col h-screen overflow-hidden">
                    <header className="bg-white border-b px-4 py-3 flex items-center justify-between z-40">
                        <h1 className="text-xl font-black text-indigo-600">SmartKasir</h1>
                        <button onClick={() => setIsCartOpen(true)} className="relative p-2 bg-slate-100 rounded-full">
                            <Icons.Cart />
                            {cart.length > 0 && <span className="absolute -top-1 -right-1 bg-rose-500 text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full border-2 border-white">{cart.length}</span>}
                        </button>
                    </header>

                    <main className="flex-1 overflow-auto bg-slate-50">
                        {activeView === 'POS' && (
                            <div className="p-4 space-y-4 pb-24">
                                <input type="text" placeholder="Cari..." className="w-full bg-white border rounded-2xl p-4 outline-none" value={searchTerm} onChange={e => setSearchTerm(e.target.value)} />
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    {filteredProducts.map(p => (
                                        <button key={p.id} onClick={() => addToCart(p)} className="bg-white p-3 rounded-3xl border shadow-sm text-left">
                                            <img src={p.image} className="w-full aspect-square object-cover rounded-2xl mb-2" />
                                            <h4 className="font-bold text-sm truncate">{p.name}</h4>
                                            <p className="text-indigo-600 font-black">Rp {p.price.toLocaleString('id-ID')}</p>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}
                        {activeView === 'INVENTORY' && <InventoryView products={products} setProducts={setProducts} />}
                        {activeView === 'HISTORY' && <HistoryView transactions={transactions} />}
                    </main>

                    {isCartOpen && (
                        <div className="fixed inset-0 z-[100] flex justify-end">
                            <div className="absolute inset-0 bg-black/20" onClick={() => setIsCartOpen(false)} />
                            <div className="relative w-full max-w-sm bg-white h-full shadow-2xl flex flex-col p-6">
                                <h2 className="text-2xl font-black mb-6">Keranjang</h2>
                                <div className="flex-1 overflow-y-auto space-y-4 no-scrollbar">
                                    {cart.map(i => (
                                        <div key={i.id} className="flex justify-between items-center">
                                            <span>{i.name} x{i.quantity}</span>
                                            <span className="font-bold">Rp {(i.price * i.quantity).toLocaleString('id-ID')}</span>
                                        </div>
                                    ))}
                                </div>
                                <div className="border-t pt-4 space-y-4">
                                    <div className="flex justify-between text-xl font-black"><span>Total</span><span>Rp {total.toLocaleString('id-ID')}</span></div>
                                    <button onClick={handlePay} className="w-full bg-indigo-600 text-white py-4 rounded-2xl font-black">BAYAR SEKARANG</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <nav className="bg-white border-t px-8 py-3 pb-safe flex justify-between fixed bottom-0 left-0 right-0">
                        <button onClick={() => setActiveView('POS')} className={activeView === 'POS' ? 'text-indigo-600' : 'text-slate-400'}><Icons.Home /></button>
                        <button onClick={() => setActiveView('INVENTORY')} className={activeView === 'INVENTORY' ? 'text-indigo-600' : 'text-slate-400'}><Icons.Inventory /></button>
                        <button onClick={() => setActiveView('HISTORY')} className={activeView === 'HISTORY' ? 'text-indigo-600' : 'text-slate-400'}><Icons.History /></button>
                    </nav>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);

        // Register SW
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').catch(console.error);
            });
        }
    </script>
</body>
</html>
